---
import type { Module as ModuleType } from "../data/seoModules";

export interface Props {
  module: ModuleType;
}

const { module } = Astro.props;
---

<div class="group hover:opacity-95 transition-opacity duration-200" data-module={module.id} data-module-id={module.id}>
  <div
    class={`w-full py-6 cursor-pointer transition-all duration-200 ease-out focus:outline-none focus-visible:bg-stone-50 focus-visible:rounded-lg ${module.isPaid ? "opacity-75" : ""}`}
    data-module-toggle={module.id}
    role="button"
    tabindex="0"
    aria-expanded="false"
  >
    <div class="flex items-start justify-between">
      <div class="flex-1">
        <div class="flex items-center mb-2">
          <span
            class={`w-6 h-6 text-xs rounded-full mr-3 flex items-center justify-center ${module.isPaid ? "gold-circle" : "bg-gray-900 text-white"}`}
          >
            {module.isPaid ? "â˜…" : module.id}
          </span>
          <h2
            class={`font-instrument text-xl font-normal ${module.isPaid ? "text-gray-500" : "text-gray-900"}`}
          >
            {module.title}
            {
              module.isPaid && (
                <span class="ml-2 text-xs text-gold-600" data-module-lock-badge>ðŸ”’ Login to unlock</span>
              )
            }
          </h2>
        </div>
        <p
          class={`text-xs ml-9 ${module.isPaid ? "text-gray-400" : "text-gray-500"}`}
        >
          {module.description}
        </p>
      </div>
      <svg
        class="w-4 h-4 text-gray-400 transition-transform duration-200"
        data-chevron={module.id}
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="1.5"
          d="M19 9l-7 7-7-7"></path>
      </svg>
    </div>
  </div>

  <!-- Module content container -->
  <div class="hidden" data-module-content={module.id}>
    <div class="ml-9 mt-4 space-y-3" data-steps-container={module.id}>
      {module.steps.map((step) => (
        <div class={`border-l-2 border-gray-200 pl-4 py-2 ${step.isPaid ? "premium-locked" : ""}`} data-step={step.id} data-premium={step.isPaid ? "true" : undefined}>
          <!-- Step Header - always visible (no accordion) -->
          <div class={`p-2 rounded ${step.isPaid ? "bg-stone-50" : ""}`}>
            <div class="flex-1">
              <div class="flex items-center mb-1">
                <h3 class={`text-sm font-medium ${step.isPaid ? "text-gray-500" : "text-gray-900"}`}>
                  {step.title}
                </h3>
                {step.isPaid && (
                  <span class="ml-2 text-xs text-gold-600" data-lock-badge>
                    ðŸ”’ Login to unlock
                  </span>
                )}
              </div>
              <div class={`text-xs ${step.isPaid ? "text-gray-500" : "text-gray-700"}`} set:html={step.action}></div>
            </div>

            <!-- Tip callout (always visible) -->
            {!step.isPaid && (
              <div class="mt-2">
                <div class="callout-tip text-xs text-gray-700">
                  <span class="font-medium text-gold-700">ðŸ’¡ Tip: </span>
                  {step.tip}
                </div>
              </div>
            )}

            <!-- Example callout (always visible) -->
            {!step.isPaid && step.example && (
              <div class="mt-2">
                <div class="callout-example text-xs text-gray-700">
                  <span class="font-medium text-gray-800">ðŸ“‹ Example: </span>
                  <span set:html={step.example}></span>
                </div>
              </div>
            )}
          </div>
        </div>
      ))}
    </div>
  </div>
</div>
