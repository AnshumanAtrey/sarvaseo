---
import type { Module as ModuleType } from "../data/seoModules";

export interface Props {
  module: ModuleType;
}

const { module } = Astro.props;
---

<div class="group hover:opacity-95 transition-opacity duration-200" data-module={module.id}>
  <div
    class={`w-full py-6 cursor-pointer transition-all duration-200 ease-out focus:outline-none focus-visible:bg-yellow-50 focus-visible:rounded-lg ${module.isPaid ? "opacity-75" : ""}`}
    data-module-toggle={module.id}
    role="button"
    tabindex="0"
    aria-expanded="false"
  >
    <div class="flex items-start justify-between">
      <div class="flex-1">
        <div class="flex items-center mb-2">
          <span
            class={`w-6 h-6 text-xs rounded-full mr-3 flex items-center justify-center ${module.isPaid ? "bg-yellow-400 text-gray-900" : "bg-gray-900 text-white"}`}
          >
            {module.isPaid ? "â˜…" : module.id}
          </span>
          <h2
            class={`font-instrument text-xl font-normal ${module.isPaid ? "text-gray-600" : "text-gray-900"}`}
          >
            {module.title}
            {
              module.isPaid && (
                <span class="ml-2 text-xs text-yellow-600" data-module-lock-badge>ðŸ”’ Login to unlock</span>
              )
            }
          </h2>
        </div>
        <p
          class={`text-xs ml-9 ${module.isPaid ? "text-gray-400" : "text-gray-600"}`}
        >
          {module.description}
        </p>
      </div>
      <svg
        class="w-4 h-4 text-gray-400 transition-transform duration-200"
        data-chevron={module.id}
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="1.5"
          d="M19 9l-7 7-7-7"></path>
      </svg>
    </div>
  </div>

  <!-- Module content container -->
  <div class="hidden" data-module-content={module.id}>
    <div class="ml-9 mt-4 space-y-3" data-steps-container={module.id}>
      {module.steps.map((step) => (
        <div class={`border-l-2 border-gray-200 pl-4 py-2 ${step.isPaid ? "premium-locked" : ""}`} data-step={step.id} data-premium={step.isPaid ? "true" : undefined}>
          <!-- Step Header -->
          <div
            class={`flex items-start justify-between p-2 rounded cursor-pointer transition-colors duration-150 ${step.isPaid ? "bg-yellow-50 border border-yellow-200 hover:bg-yellow-100" : "hover:bg-gray-50"}`}
            data-step-toggle={step.id}
            role="button"
            tabindex="0"
            aria-expanded="false"
          >
            <div class="flex-1">
              <div class="flex items-center mb-1">
                <h3 class={`font-instrument text-sm ${step.isPaid ? "text-gray-600" : "text-gray-900"}`}>
                  {step.title}
                </h3>
                {step.isPaid && (
                  <span class="ml-2 text-xs text-yellow-600" data-lock-badge>
                    ðŸ”’ Login to unlock
                  </span>
                )}
              </div>
              <div class={`text-xs ${step.isPaid ? "text-gray-500" : "text-gray-600"}`} set:html={step.action}></div>
            </div>
            <svg
              class={`w-3 h-3 transition-transform duration-200 flex-shrink-0 mt-1 ${step.isPaid ? "text-yellow-500" : "text-gray-400"}`}
              data-step-chevron={step.id}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              ></path>
            </svg>
          </div>

          <!-- Step Details (rendered for ALL steps, hidden by default) -->
          <div class="hidden mt-2" data-step-content={step.id}>
            <div class="pl-2 space-y-2">
              <div class="text-xs text-gray-600 italic bg-yellow-50 p-2 rounded border border-yellow-200">
                <span class="font-instrument font-medium text-yellow-700">ðŸ’¡ Tip: </span>
                {step.tip}
              </div>
              {step.example && (
                <div class="text-xs text-gray-700 bg-gray-50 p-2 rounded border border-gray-200">
                  <span class="font-instrument font-medium text-gray-800">ðŸ“‹ Example: </span>
                  <span set:html={step.example}></span>
                </div>
              )}
            </div>
          </div>

        </div>
      ))}
    </div>
  </div>
</div>




